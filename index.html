<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gleichgewicht</title>
  <meta name="description" content="Links, PDFs, videos, and notes." />
  <link rel="stylesheet" href="assets/style.css" />
</head>

<body>
  <header class="site-header">
    <h1 class="site-title">Gleichgewicht</h1>
    <p class="site-subtitle">Links, PDFs, videos, and notes.</p>
  </header>

  <main class="content" id="content"></main>

  <footer class="site-footer">
    <p>Static repository site.</p>
  </footer>

<script>
async function loadLibrary() {
  const res = await fetch("library.json", { cache: "no-store" });
  const data = await res.json();
  const container = document.getElementById("content");

  data.sections.forEach(section => {
    const sec = document.createElement("section");
    sec.className = "section";

    const h2 = document.createElement("h2");
    h2.textContent = section.title;
    sec.appendChild(h2);

    const list = document.createElement("ul");
    list.className = "list";

    const videos = [];

    section.items.forEach(item => {
      if (item.type === "youtube") {
        videos.push(item);
        return;
      }

      const li = document.createElement("li");
      li.className = "list-item";

      const tag = document.createElement("span");
      tag.className = "tag";
      tag.textContent = item.type.toUpperCase();
      li.appendChild(tag);

      const a = document.createElement("a");
      a.href = item.url;
      a.textContent = item.title;

      if (item.type === "link") {
        a.target = "_blank";
        a.rel = "noopener noreferrer";
      }

      li.appendChild(a);

      if (item.note) {
        const note = document.createElement("span");
        note.className = "note";
        note.textContent = " â€” " + item.note;
        li.appendChild(note);
      }

      list.appendChild(li);
    });

    if (list.children.length > 0) {
      sec.appendChild(list);
    }

    if (videos.length > 0) {
      const grid = document.createElement("div");
      grid.className = "video-grid";

      videos.forEach(v => {
        const figure = document.createElement("figure");
        figure.className = "video";

        const frame = document.createElement("div");
        frame.className = "video-frame";

        const iframe = document.createElement("iframe");
        iframe.src = `https://www.youtube.com/embed/${v.id}`;
        iframe.title = v.title;
        iframe.loading = "lazy";
        iframe.allowFullscreen = true;

        frame.appendChild(iframe);
        figure.appendChild(frame);

        const cap = document.createElement("figcaption");
        cap.textContent = v.title;
        figure.appendChild(cap);

        grid.appendChild(figure);
      });

      sec.appendChild(grid);
    }

    container.appendChild(sec);
  });
}

loadLibrary();
</script>
</body>
</html>
